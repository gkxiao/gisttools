# gisttools
Post-processing of data generated by the GIST (Grid Inhomogeneous Solvation Theory) action in cpptraj

Grid Inhomogeneous Solvation Theory (GIST) is a method first devised by Gilson and coworkers, that calculates thermodynamic properties of hydration on a 3-dimensional grid, based on a Molecular Dynamics (MD) simulation of a restrained solute molecule in explicit solvent. GIST is implemented in the cpptraj program (AmberTools). The output of GIST is a table of thermodynamic quantities (e.g. enthalpic and entropic contributions to hydration) for each grid voxel.

This Python module is a collection of tools that are intended for easy handling and further post-processing of GIST output files. The core functionality has been repeatedly used in scientific work at the university of Innsbruck. However, the module is still quickly evolving and the user interface can (and will) change without warning! Also, notice that more specialized use cases might not have been tested.

## Overview of functionality
* Load GIST output files in table format (using pandas) or .dx format (using gridDataFormats)
* Automatically subtract reference values for the solvent-solvent interaction enrgy and compute derived quantities such as the free energy.
* Project free energy contributions to atoms in a .pdb file. Two different methods (mean: compute the average in a sphere around each atom; nearest: assign every voxel within a certain distance of the solute to exactly one atom) are supported. Furthermore, a weighting of the voxel contributions based on the distance to an atom can be used.
* Integrate free energy contributions within a certain distance of the solute.
* Compute "rdfs", i.e., summations of the free energy contributions binned by the distance to the nearest atom. The resulting rdfs are reported per atom.
* The grid functionality can be used independently of the GIST post-processing. This can be quite handy. For instance, one can combine the grid functionality with a marching cubes algorithm (e.g., from skimage) to compute triangulated SASAs (solvent accessible surface areas).

## Installation
This module depends on the following packages:
* mdtraj
* numpy
* scipy
* pandas
* numba

Optional dependencies (only for some functionality):
* nglview (for previewing datasets)
* gridDataFormats (for loading .dx files)

You should be able to install gisttools in a local environment using `pip install .`. gisttools has been tested mainly on Pyton 3.7, but all versions >= 3.6 *should* work, so If you experience errors with any of those versions, feel free to contact me.
<h2>Mean energy per water and number density for various water models<sup>4</sup></h2>

| Water Model | Mean Energy (E<sub>ww</sub>-norm kcal/mol) | Number density (1/Å³) |
| :--- | :--- | :--- |
| TIP3P | -9.533 | 0.0329 |
| TIP4PEW | -11.036 | 0.0332 |
| TIP4P | -9.856 | 0.0332 |
| TIP5P | -9.596 | 0.0329 |
| TIP3PFW | -11.369 | 0.0334 |
| SPCE | -11.123 | 0.0333 |
| SPCFW | -11.873 | 0.0329 |

<h2>Tutorial</h2>

https://github.com/liedllab/gist-tutorial

## an example to export \(\Delta G\).dx file
```
# 导入必要的库
from gisttools.gist import load_gist_file
import gisttools as gt  # 可选，用于别名

# 步骤1: 加载GIST输出文件和溶质结构
# 假设gist.dat是GIST输出文件，solute-centered.pdb是溶质结构文件
# 设置参考能量eww_ref（根据溶剂模型选择，例如TIP3P水模型为-9.5398）
gist = load_gist_file('gist.dat', struct='solute-centered.pdb', eww_ref=-9.5398)

# 步骤2: 检查数据加载是否正确（可选）
print(f"帧数: {gist.n_frames}")
print(f"参考密度: {gist.rho0}")
# 确保A_dens列已自动计算（GISTTOOLS会从Eww、Esw和熵列推导出A_dens）
# A_dens列表示每个体素的自由能密度（ΔA_solv_dens），单位是kcal/mol/Å³

# 步骤3: 可选步骤——处理熵参考（如果自由能收敛不理想，可能需要调整熵参考）
# 文档第4.4.4节提到，熵可能因采样偏差而发散，可引用参考值校正
def reference_entropy(gf):
    if 'dTSsix_unref_norm' not in gf.data.columns:
        gf['dTSsix_unref_norm'] = gf['dTSsix_norm']
        gf['dTSsix_unref_dens'] = gf['dTSsix_dens']
    refval = gf.detect_reference_value('dTSsix_unref_dens')
    gf['dTSsix_norm'] = gf.get_referenced('dTSsix_unref_norm', refval)
    gf['dTSsix_dens'] = gf.get_referenced('dTSsix_unref_dens', refval)

# 应用熵参考校正（如果需要）
reference_entropy(gist)

# 步骤4: 导出A_dens列为DX文件
# 使用save_dx方法，第一个参数是列名（'A_dens'），第二个是输出文件名
gist.save_dx('A_dens', 'deltaG_density.dx')

print("DX文件已导出为 deltaG_density.dx")
```

<h2>Reference</h2>
<ol>
   <li>Hu, B.; Lill, M. A. Protein Pharmacophore Selection Using Hydration-Site Analysis. J. Chem. Inf. Model. 2012, 52 (4), 1046–1060. https://doi.org/10.1021/ci200620h.</li>
   <li>Yoshida, S.; Uehara, S.; Kondo, N.; Takahashi, Y.; Yamamoto, S.; Kameda, A.; Kawagoe, S.; Inoue, N.; Yamada, M.; Yoshimura, N.; et al. Peptide-to-Small Molecule: A Pharmacophore-Guided Small Molecule Lead Generation Strategy from High-Affinity Macrocyclic Peptides. 2022. https://doi.org/10.1021/acs.jmedchem.2c00919.</li>
  <li>Jung, S. W.; Kim, M.; Ramsey, S.; Kurtzman, T.; Cho, A. E. Water Pharmacophore: Designing Ligands Using Molecular Dynamics Simulations with Water. Sci. Rep. 2018, 8 (1), 10400. https://doi.org/10.1038/s41598-018-28546-z.</li>
  <li>Ramsey, S.; Nguyen, C.; Salomon-Ferrer, R.; Walker, R. C.; Gilson, M. K.; Kurtzman, T. Solvation Thermodynamic Mapping of Molecular Surfaces in AmberTools: GIST. J. Comput. Chem. 2016, 37 (21), 2029–2037. https://doi.org/10.1002/jcc.24417.</li>
</ol>
